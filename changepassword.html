<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Change Password - Engineer Remote/Onsite Attendance Portal</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
  <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-md">
    <h1 class="text-2xl font-bold text-center mb-4">Change Password</h1>
    
    <!-- Change Password Form -->
    <div class="mb-6">
      <input id="oldPassword" type="password" class="w-full p-2 border rounded mb-2" placeholder="Old Password">
      <input id="newPassword" type="password" class="w-full p-2 border rounded mb-2" placeholder="New Password">
      <input id="confirmNewPassword" type="password" class="w-full p-2 border rounded mb-2" placeholder="Confirm New Password">
      <button class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full" onclick="changePassword()">Save</button>
      <p id="changePasswordError" class="mt-2 text-red-600 hidden text-center"></p>
    </div>
    
    <!-- Back Button -->
    <button class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 w-full" onclick="window.location.href = 'attendance.html'">Back</button>
  </div>

  <script>
    let currentUser = null;

    function checkLogin() {
      const storedUser = localStorage.getItem('loggedIn');
      if (!storedUser) {
        window.location.href = 'index.html';
        return;
      }
      currentUser = JSON.parse(storedUser);
    }

    function loadUsers() {
      return JSON.parse(localStorage.getItem('users')) || {};
    }

    function saveUsers(users) {
      localStorage.setItem('users', JSON.stringify(users));
    }

    function changePassword() {
      const oldPassword = document.getElementById('oldPassword').value.trim();
      const newPassword = document.getElementById('newPassword').value.trim();
      const confirmNewPassword = document.getElementById('confirmNewPassword').value.trim();
      const errorElement = document.getElementById('changePasswordError');
      const users = loadUsers();

      if (newPassword !== confirmNewPassword) {
        errorElement.textContent = 'New passwords do not match.';
        errorElement.classList.remove('hidden');
        return;
      }
      if (users[currentUser.username].password !== oldPassword) {
        errorElement.textContent = 'Old password is incorrect.';
        errorElement.classList.remove('hidden');
        return;
      }
      if (newPassword === '') {
        errorElement.textContent = 'New password cannot be empty.';
        errorElement.classList.remove('hidden');
        return;
      }

      users[currentUser.username].password = newPassword;
      saveUsers(users);
      errorElement.classList.add('hidden');
      document.getElementById('oldPassword').value = '';
      document.getElementById('newPassword').value = '';
      document.getElementById('confirmNewPassword').value = '';
      alert('Password changed successfully.');
      window.location.href = 'attendance.html';
    }

    window.onload = () => {
      checkLogin();
    };
  </script>
</body>
</html>